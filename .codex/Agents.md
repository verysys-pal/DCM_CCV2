# 한국어 응답 규칙
## 언어 설정
- 모든 응답은 한국어로 작성합니다.
- 코드 주석도 가능한 한 한국어로 작성합니다.
- 기술 용어는 필요 시 영어와 한국어를 병행 표기합니다 (예: 컨테이너(container)).
- 에러 메시지·로그는 원문 유지, 설명은 한국어로 제공합니다.
## 예외 상황
- 파일명은 영어로 작성.
- 코드(식별자)는 영어로 작성(변수명, 함수명 등).
- 공식 문서/명령어는 원문 유지.
- 사용자가 다른 언어를 명시 요청한 경우에만 예외.

# 프롬프트 작업 규칙
- 모든 작업 흔적은 `docs/note_working.md`에 일관된 형식으로 누락 없이 기록.
- 새 항목 앞에 반드시 빈 줄 3개 삽입해 항목 구분.
- 기록 항목: 의도/배경, 변경사항 요약, 수정 파일 경로와 요지, 비고(이슈/의존성).
- 파일을 변경하면 관련 문서(README/mermaid/설정) 동시 갱신을 검토.

기록 템플릿 예시:

```
YYYY-MM-DD HH:MM (작성자)
의도: …
변경: …
수정파일: a/b/c.py, d/e.md …
비고: …
```

# 파일 참조/라인 표기 규칙
- 파일 경로는 클릭 가능한 형태로 표기: `path/to/file.ext`
- 라인 표기: `path/to/file.ext:42` 또는 `path/to/file.ext#L42`
- 범위 표기는 지양하고 단일 라인 기준으로 참조.

# Mermaid/문서 갱신 규칙
- 다이어그램은 영어 라벨을 우선 사용하되, 실제 경로나 모듈명은 하위 줄로 병기.
- 엣지(화살표) 주석은 데이터 방향과 의미가 드러나게 구체화.
- 레이아웃은 기본 `LR` 유지, 필요한 경우만 `TB` 등으로 변경.
- 파일 위치: `docs/mermaid/*.mmd` (예: `docs/mermaid/data_flow.mmd`).

# 코드 작성 규칙(역할/경계)
- `tools/pv_bridge.py`: EPICS ↔ 시뮬레이터 간 순수 중계 역할 유지.
  - I/O(읽기/쓰기)와 구성 반영에 집중, 파생 계산/시퀀스 로직을 내부에 두지 않음.
- `sim/logic/operating.py`: 운전(시퀀스) 관리 담당.
  - 상태 전이, 명령 해석, 파생값 계산(필요 시)을 여기서 수행.
- `sim/core/dcm_cryo_cooler_sim.py`: 물리 시뮬레이션(온도, 압력, 유량 등) 담당.
  - 모델 상태 업데이트와 내부 물리 규칙을 관리.
- 설정은 `tools/*.yaml`에서 읽어 브리지가 주입(config/튜닝/인터락/운전 파라미터).
- 책임 혼합 금지: 브리지에 시퀀스/물리 로직을 넣지 않고, 로직 모듈에서 EPICS I/O를 수행하지 않음.

# 작업 프로세스 체크리스트
- 변경 범위 정의: 목적/영향 모듈 명확화.
- 최소 단위 수정: 작은 패치로 나누고 각 단계 기록.
- 문서 동기화: mermaid/README/설정 파일 갱신 여부 확인.
- 로컬 검증: 기본 테스트/스모크 런 수행(가능 시 `pytest`, 샌드박스 환경 제약 고려).
- 기록 반영: `docs/note_working.md`에 3줄 공백 규칙으로 로그 추가.

# 추가 가이드
- PV 네이밍/스코프는 기존 패턴을 준수(예: `BL:DCM:CRYO:*`).
- 새 파라미터 도입 시 기본값과 유효 범위를 `tools/*.yaml`에 정의하고 코드에서 검증.
- 인터락/안전 관련 변경은 주석과 문서에 근거/가정을 명확히 기재.
