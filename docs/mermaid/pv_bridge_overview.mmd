%% PV Bridge (tools/pv_bridge.py) — 아키텍처 개요
%% 단일 그래프 렌더러 호환 버전

%%{init: {
  "theme":"base",
  "themeVariables":{"background":"#ffffff","primaryTextColor":"#111111"
}}}%%

flowchart LR
  subgraph Bridge[PV Bridge]
    BR[PVBridge]
  end

  subgraph Logic[Logic]
    OP[OperatingLogic]
    SEQ[Sequencer]
    ILK[InterlockLogic]
  end

  subgraph Sim[Simulator]
    SIM[sim.core.CryoCoolerSim]
  end

  subgraph IOC[EPICS IOC]
    PVs[(PVs)]
  end

  subgraph Cfg[Configs]
    CLI[(CLI args: dt, q_dcm, init-config, log-interval, hist-interval, verbose)]
    YAML["pv_init.yaml<br/>operating.yaml (optional)<br/>interlock.yaml (optional)"]
  end

  CLI --> BR
  YAML --> BR
  BR <-->|read/write| PVs
  BR <-->|controls/state| SIM
  BR -.-> OP
  BR -.-> ILK
  BR -.-> SEQ
  SEQ --> SIM

  classDef group fill:#eef,stroke:#446,color:#111;
  class Bridge,Logic,Sim,IOC,Cfg group;

  %% data_flow.mmd로 이동하는 하이퍼링크
  click BR "data_flow.mmd" "Open: Overall data flow"
